<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<th:block th:replace="~{/layout/content :: setContent(~{this :: content})}">
    <th:block th:fragment="content">

        <h1 class="mt-4">영화 상세 : [[${result.movieName}]]</h1>

        <div class="form-group">
            <label >Title</label>
            <input class="form-control" th:value="${result.movieName}" name="title" readonly>
        </div>
        <div class="form-group">
            <p>Image Location</p>
        </div>
        <div class="form-group">
            <label >Director</label>
            <input class="form-control" th:value="${result.director}" name="director" readonly>
        </div>
        <div class="form-group">
            <label >Running Time</label>
            <input class="form-control" th:value="${result.runningTime}" name="runningTime" readonly>
        </div>

        <a class="btn btn-warning" th:href="@{/movies/info(page=${pageRequestDTO.page})}">돌아가기</a>

        <div class="reviewList">

        </div>

        <script th:inline="javascript">

            $(document).ready(function(){
                var reviewList = $(".reviewList");
                var movieId = [[${result.id}]];

                $.getJSON("/reviews/"+movieId, function(arr){
                    console.log(arr);
                    makeReviewPage(arr);
                });

                $(".reviewList").on("click", ".page-link", function(){

                    var page = $(this).data("page");

                    $.ajax({
                        url: "/reviews/"+movieId+"/?page="+page,
                        method: "GET",
                        contentType: "application/json; charset=utf-8",
                        dataType: 'json',
                        success: function(arr){
                            console.log(arr);
                            makeReviewPage(arr);
                        }
                    });

                });

                function makeReviewPage(arr) {
                    var data = arr["dtoList"];
                    var str = "";

                    $.each(data, function(idx, review){

                        str += "<div>";
                        str += "<h5>"+review.content+"</h5>";
                        str += "<h6>"+review.writer+"</h6>";
                        str += "<h6>"+review.grade+"</h6>";
                        str += "</div>";

                    });

                    str += "<ul class='pagination h-100 justify-content-left align-items-center'>";
                    if(arr.prev) {
                        str += "<li class='page-item'>";
                        str += "<a class='page-link' data-page='"+(arr.start - 1)+"' tabindex='-1'>PREVIOUS</a>"
                        str += "</li>";
                    }

                    for(var pageIndex = 0; pageIndex < arr.pageList.length; pageIndex++) {
                        str += "<li>";
                        str += "<a class='page-link' data-page='"+arr.pageList[pageIndex]+"'>"+arr.pageList[pageIndex]+"</a>";
                        str += "</li>";
                    }

                    if(arr.next) {
                        str += "<li class='page-item'>";
                        str += "<a class='page-link' data-page='"+(arr.end + 1)+"'>NEXT</a>"
                        str += "</li>";
                    }
                    str += "</ul>";

                    reviewList.html(str);
                }
            });

        </script>

    </th:block>
</th:block>

</html>